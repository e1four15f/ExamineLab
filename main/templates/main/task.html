{% extends 'main/header.html' %}

{% block content %}
    <div class="row">

        <nav class="clean">
            <div class="nav-wrapper">
                <div class="col s12">
                    <a href="/courses" class="breadcrumb">Курсы</a>
                    <a href="/courses/{{ course.id }}" class="breadcrumb">{{ course.title }}</a>
                </div>
            </div>
        </nav>

        <h3>{{ task.title }}</h3>
        <p>{{ task.summary }}</p>

        <div class="col s2">
            <div class="switch">
                <label>
                    <p>Night mode</p>
                    <input id="switch-mode" type="checkbox">
                    <span class="lever"></span>
                </label>
            </div>
        </div>
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="col s7">
                <div class="file-field input-field">
                    <div class="btn">
                        <span>Загрузить файл</span>
                        {{ upload_code_form }}
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text">
                    </div>
                </div>
            </div>
       

            <div class="input-field col s3">
                <select name="language" onchange="$('#upload_form').attr('accept', this.value)">
                    {% for language in languages %}
                        <option value="{{ language.extention }}">{{ language.name }}</option>
                    {% endfor %}
                </select>
                <label>Язык</label>
            </div>

            <div class="input-field col s12">
                {% load djangocodemirror_tags %}
                
                {{ submit_form.as_p }}
                
                <button class="btn waves-effect waves-light">
                    Submit<i class="material-icons right">send</i>
                </button>
            
                {% codemirror_field_css_assets submit_form.submit_solution %}
                {% codemirror_field_js_assets submit_form.submit_solution %}
                
                <script>
                    var foo_codemirror = CodeMirror.fromTextArea(
                        document.getElementById("id_submit_solution"),
                        {{ submit_form.submit_solution|codemirror_parameters }}
                    );
                </script>
            </div>
        </form>

        <div class="input-field col s6">
            <h4>Решение задачи</h4>
            <span style="white-space: pre-line">{{ task.solution }}</span>
        </div>

        <div class="input-field col s6">
            <h4>Тесты</h4>
            {% for test in tests %}
                <span>{{ test.title }}</span>
                {% if not passed %}
                    <i class="tiny material-icons yellow">cached</i>
                {% else %}
                    {% if passed|get_item:test.title %}
                        <i class="tiny material-icons green">check</i>
                    {% else %}
                        <i class="tiny material-icons red">close</i>
                    {% endif %}
                {% endif %}
                </br>
            {% endfor %}
        </div>

        <div class="input-field col s6">
            <h4>Ошибки</h4>
            <textarea rows="80" cols="25" name="errors">{{ error }}</textarea>
        </div>


    </div>

    
    <script>
        $(document).ready(function(){
            $('select').formSelect();
        });

        $('#switch-mode').click(function(){
            var el = $('div.CodeMirror');
            if (el.hasClass('cm-s-eclipse')) {               
                el.removeClass('cm-s-eclipse');
                el.addClass('cm-s-material');
            } else {
                el.addClass('cm-s-eclipse');
                el.removeClass('cm-s-material');
            }
        });
    </script>
{% endblock %}

