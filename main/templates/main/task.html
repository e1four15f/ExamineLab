{% extends 'main/header.html' %}

{% block content %}
    <div class="row">

        <nav class="clean">
            <div class="nav-wrapper">
                <div class="col s12">
                    <a href="/courses" class="breadcrumb">Курсы</a>
                    <a href="/courses/{{ course.id }}" class="breadcrumb">{{ course.title }}</a>
                </div>
            </div>
        </nav>

        <h3>{{ task.title }}</h3>
        <p>{{ task.summary }}</p>

        <div class="col s2">
            <div class="switch">
                <label>
                    <p>Night mode</p>
                    <input id="switch-mode" type="checkbox">
                    <span class="lever"></span>
                </label>
            </div>
        </div>

        <div class="col s7">
            <form action="#">
                <div class="file-field input-field">
                    <div class="btn">
                        <span>Загрузить файл</span>
                        <input type="file">
                    </div>
                    <div class="file-path-wrapper"><input class="file-path validate" type="text">
                    </div>
                </div>
            </form>
        </div>

        <div class="input-field col s3">
            <select>
                <!-- TODO получать список языков из бд -->
                <option value="1">Python</option>
                <option value="2">C++</option>
                <option value="3">Java</option>
            </select>
            <label>Язык</label>
        </div>

        <div class="input-field col s12">
            {% load djangocodemirror_tags %}
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                    <i class="material-icons right">send</i>
                </button>
            </form>
            
            {% codemirror_field_css_assets form.submit_solution %}
            {% codemirror_field_js_assets form.submit_solution %}
            
            <script>
                var foo_codemirror = CodeMirror.fromTextArea(
                    document.getElementById("id_submit_solution"),
                    {{ form.submit_solution|codemirror_parameters }}
                );
            </script>
        </div>

        <div class="input-field col s6">
            {% if user.is_superuser %}
                <h4>Решение задачи</h4>
                <span style="white-space: pre-line">{{ task.solution }}</span>
            {% endif %}
        </div>

        <div class="input-field col s6">
            <h4>Тесты</h4>
            {% for test in tests %}
                <span>{{ test.title }}</span>
                {% if not passed %}
                    <i class="tiny material-icons yellow">cached</i>
                {% else %}
                    {% if passed|get_item:test.title %}
                        <i class="tiny material-icons green">check</i>
                    {% else %}
                        <i class="tiny material-icons red">close</i>
                    {% endif %}
                {% endif %}
                </br>
            {% endfor %}
        </div>
    </div>

    
    <script>
        $(document).ready(function(){
            $('select').formSelect();
        });

        $('#switch-mode').click(function(){
            var el = $('div.CodeMirror');
            if (el.hasClass('cm-s-eclipse')) {               
                el.removeClass('cm-s-eclipse');
                el.addClass('cm-s-material');
            } else {
                el.addClass('cm-s-eclipse');
                el.removeClass('cm-s-material');
            }
        });
    </script>
{% endblock %}

